# 要件定義書 - Windows Things3 ダッシュボード

**プロジェクト名**: Windows Things3 ダッシュボード
**バージョン**: 1.1
**最終更新日**: 2026-01-31
**ステータス**: 完全版API仕様統合済み

---

## 1. プロジェクト概要

### 1.1 目的
Mac上のThings3タスクデータを閲覧・更新するためのWindows用Webダッシュボードを開発する。バックエンド（Mac側）はPython/FastAPIで構築され、Tailscale経由でJSONデータを配信する。本ドキュメントはWindows側クライアント（フロントエンド）の詳細要件を定義する。

### 1.2 スコープ
- **対象範囲（Phase 1）**:
  - Things3風UIでのタスク閲覧
  - タスクの更新機能（完了状態の変更）
  - タスクの新規作成機能
  - プロジェクトの新規作成機能
  - タスク検索機能
  - Mac APIサーバーとの非同期通信
  - 自動データ更新機能
  - モックデータモードでの開発サポート
  - レスポンシブデザイン
  - ヘルスチェック機能

- **対象外（Phase 1）**:
  - タスクの削除機能
  - タスクの編集機能（タイトル・メモ・期限の変更）
  - プロジェクトの編集・削除機能
  - キーボードショートカット
  - ダークモード
  - マルチユーザー対応
  - オフラインキャッシュ

---

## 2. 機能要件

### 2.1 ユーザーストーリー

#### US-01: タスク一覧の閲覧
**立場**: Windowsユーザー
**目的**: Mac上のThings3タスクを一覧表示したい
**理由**: Windowsマシンからでもタスク状況を把握できるようにするため

**受入基準**:
- Inbox、Today、Upcoming、Areas/Projectsの各ビューが表示される
- 各タスクにはタイトル、期限、タグ、メモが表示される
- サイドバーでビューを切り替えられる

#### US-02: タスクの更新
**立場**: ユーザー
**目的**: タスクの完了状態を変更したい
**理由**: WindowsからでもThings3のタスクを管理できるようにするため

**受入基準**:
- タスクのチェックボックスをクリックして完了状態を変更できる
- 更新がMac側APIサーバーに送信される
- 更新成功/失敗のフィードバックが表示される

#### US-03: データの自動更新
**立場**: ユーザー
**目的**: タスクデータが自動的に最新に保たれるようにしたい
**理由**: 常に最新のタスク状況を確認できるようにするため

**受入基準**:
- 1分間隔で自動的にデータが更新される
- 手動更新ボタンでオンデマンド更新ができる
- 更新中はローディングインジケータが表示される

#### US-04: エラーハンドリング
**立場**: ユーザー
**目的**: API接続エラーが発生したときに通知を受けたい
**理由**: 問題を認識し対処できるようにするため

**受入基準**:
- APIサーバー到達不能時にエラーメッセージが表示される
- エラーメッセージには原因と対処方法が含まれる
- 再試行ボタンが提供される

#### US-05: モック開発モード
**立場**: 開発者
**目的**: Mac環境なしで開発・テストしたい
**理由**: 開発効率を上げるため

**受入基準**:
- 環境変数でモックモードを有効化できる
- モックデータは実際のAPI構造と一致する
- モックモードとAPI接続モードを簡単に切り替えられる

#### US-06: タスク検索
**立場**: ユーザー
**目的**: キーワードでタスクを検索したい
**理由**: 大量のタスクの中から目的のタスクを素早く見つけるため

**受入基準**:
- 検索ボックスにキーワードを入力できる
- タイトル・メモ・タグを横断して検索される
- 検索結果がリアルタイムに表示される
- 検索結果をクリックしてタスク詳細を表示できる

#### US-07: タスク作成
**立場**: ユーザー
**目的**: 新しいタスクを作成したい
**理由**: WindowsからでもThings3にタスクを追加できるようにするため

**受入基準**:
- タスク作成フォームが表示される
- タイトル、メモ、期限、タグ、所属先（Inbox/プロジェクト/エリア）を設定できる
- 作成ボタンで新規タスクがMac側APIに送信される
- 作成成功後、タスクリストに即座に反映される
- バリデーションエラーが適切に表示される

#### US-08: プロジェクト作成
**立場**: ユーザー
**目的**: 新しいプロジェクトを作成したい
**理由**: タスクを整理するためのプロジェクトを追加できるようにするため

**受入基準**:
- プロジェクト作成フォームが表示される
- プロジェクト名、所属エリア、説明、期限を設定できる
- 作成成功後、サイドバーに即座に反映される
- エラー時は適切なメッセージが表示される

#### US-09: ヘルスチェック
**立場**: ユーザー
**目的**: APIサーバーの稼働状況を確認したい
**理由**: 接続問題を早期に検知できるようにするため

**受入基準**:
- アプリ起動時にヘルスチェックが実行される
- サーバーダウン時は警告メッセージが表示される
- ステータス表示（接続中/切断）がヘッダーに表示される

---

### 2.2 機能仕様

#### F-01: サイドバーナビゲーション
**説明**: Things3風のサイドバーでビューを切り替える

**詳細**:
- **表示項目**:
  - Inbox（インボックス）
  - Today（今日）
  - Upcoming（予定）
  - Areas（エリア一覧）
  - Projects（各エリア配下のプロジェクト）
- **動作**:
  - クリックで対応するビューに切り替え
  - 現在選択中のビューをハイライト表示
  - エリアは展開/折りたたみ可能

#### F-02: タスクリスト表示
**説明**: 選択したビューに応じたタスクリストを表示

**詳細**:
- **表示要素**:
  - チェックボックス（完了状態）
  - タスクタイトル
  - 期限（due_date）
  - タグリスト
  - メモアイコン（メモがある場合）
- **レイアウト**:
  - 縦スクロール可能なリスト
  - タスク間に適切なスペーシング
  - ホバー時の視覚フィードバック

#### F-03: タスク詳細表示
**説明**: タスクをクリックすると詳細情報を表示

**詳細**:
- **表示内容**:
  - 完全なタスクタイトル
  - メモ全文
  - 期限
  - タグ一覧
  - ステータス
- **表示方法**:
  - 右側パネルまたはモーダル
  - 閉じるボタン

#### F-04: タスク更新機能
**説明**: タスクの完了状態を変更できる

**詳細**:
- **更新可能項目（Phase 1）**:
  - 完了状態（open/completed）
- **API通信**:
  - PATCH/PUT リクエストでMac側APIに送信
  - 楽観的UI更新（即座にUIを更新し、バックグラウンドでAPI送信）
  - 失敗時はロールバック
- **フィードバック**:
  - 成功時: 一時的なトースト通知
  - 失敗時: エラーメッセージとリトライボタン

#### F-05: データ同期
**説明**: Mac側APIサーバーと定期的にデータ同期

**詳細**:
- **自動更新**:
  - 1分（60秒）間隔で自動fetch
  - バックグラウンドで実行（ページ遷移不要）
- **手動更新**:
  - ヘッダーに更新ボタン配置
  - クリックで即座にデータ再取得
- **更新インジケータ**:
  - 自動/手動更新中はスピナーまたはプログレスバー表示
  - 最終更新時刻を表示

#### F-06: エラーハンドリング
**説明**: API通信エラーを適切に処理・表示

**詳細**:
- **エラー種別**:
  - ネットワークエラー（サーバー到達不能）
  - タイムアウト
  - 4xx/5xxレスポンス
- **エラー表示**:
  - トースト通知またはバナー
  - エラー内容の説明
  - 再試行ボタン
- **フォールバック**:
  - エラー発生前のデータを保持表示
  - 接続復旧後に自動再試行

#### F-07: タスク検索
**説明**: キーワードでタスクを横断検索

**詳細**:
- **検索対象**:
  - タスクタイトル
  - タスクメモ
  - タグ
- **UI要素**:
  - ヘッダーまたはサイドバー上部に検索ボックス
  - 検索アイコン
  - クリアボタン（×）
- **動作**:
  - 入力中はデバウンス処理（300ms）
  - 検索結果を専用ビューに表示
  - ヒット件数を表示
  - 検索語をハイライト表示
- **API連携**:
  - GET `/todos/search?q={query}`
  - クエリパラメータをURLエンコード

#### F-08: タスク作成フォーム
**説明**: 新規タスクを作成するためのフォーム

**詳細**:
- **入力フィールド**:
  - タイトル（必須、テキスト）
  - メモ（任意、テキストエリア）
  - 期限（任意、日付ピッカー）
  - タグ（任意、複数選択可能）
  - 所属先（ドロップダウン: Inbox/Today/エリア/プロジェクト）
- **表示方法**:
  - モーダルまたは右パネル
  - 「新規タスク」ボタンから起動
- **バリデーション**:
  - タイトルは必須（1文字以上）
  - 期限は今日以降の日付のみ
- **API連携**:
  - POST `/todos`
  - リクエストボディ: `CreateTaskRequest`
- **フィードバック**:
  - 送信中: ボタン無効化 + ローディング
  - 成功: トースト通知 + フォームクローズ + リスト更新
  - 失敗: エラーメッセージ表示 + リトライ可能

#### F-09: プロジェクト作成フォーム
**説明**: 新規プロジェクトを作成するためのフォーム

**詳細**:
- **入力フィールド**:
  - プロジェクト名（必須、テキスト）
  - 所属エリア（任意、ドロップダウン）
  - 説明（任意、テキストエリア）
  - 期限（任意、日付ピッカー）
- **表示方法**:
  - モーダル
  - サイドバーの「+」ボタンまたはコンテキストメニューから起動
- **バリデーション**:
  - プロジェクト名は必須
  - 重複チェック（既存プロジェクト名と比較）
- **API連携**:
  - POST `/projects`
  - リクエストボディ: `CreateProjectRequest`
- **フィードバック**:
  - 成功: サイドバー即座に更新
  - 失敗: エラーメッセージ

#### F-10: ヘルスチェック & 接続ステータス
**説明**: APIサーバーの稼働状況を監視・表示

**詳細**:
- **ヘルスチェック**:
  - アプリ起動時に GET `/health` を実行
  - 5分ごとにバックグラウンドでチェック
  - タイムアウト: 5秒
- **ステータス表示**:
  - ヘッダー右上にインジケータ
  - 緑: 接続正常
  - 赤: 接続エラー
  - 灰色: 未接続
  - ホバーで詳細表示（最終チェック時刻、バージョン）
- **エラー時の挙動**:
  - 警告バナー表示「APIサーバーに接続できません」
  - 再接続ボタン
  - 他の機能は利用可能（キャッシュデータ表示）

---

## 3. 非機能要件

### 3.1 パフォーマンス
- **初期ロード時間**: 3秒以内（モックモード）
- **API応答時間**: 1秒以内でUI反映
- **再レンダリング**: タスクリスト更新は200ms以内
- **最大タスク数**: 1000タスクまで快適に動作

### 3.2 使いやすさ
- **デザイン**: Things3からインスピレーションを得た独自デザイン
  - ミニマルで清潔感のあるUI
  - 十分なホワイトスペース
  - 読みやすいタイポグラフィ
  - 淡色系のカラーパレット
- **レスポンシブ**: デスクトップ利用を主とするが、ウィンドウリサイズに対応
  - 推奨最小幅: 1024px
  - 768px以下でサイドバーを折りたたみ可能に
- **アクセシビリティ**:
  - セマンティックHTML使用
  - キーボードナビゲーション（基本的なTab移動）
  - 適切なコントラスト比

### 3.3 互換性
- **ブラウザ**:
  - Chrome（最新版 + 2バージョン前まで）
  - Edge（最新版 + 2バージョン前まで）
  - Firefox（最新版）
  - Safari（最新版）※動作確認のみ
- **OS**: Windows 10/11
- **解像度**: 1920x1080以上推奨、最小1280x720

### 3.4 セキュリティ
- **通信**:
  - Tailscale経由のローカルネットワーク通信
  - HTTPSは現段階では不要（将来的に検討）
- **認証**: Phase 1では未実装（Mac側APIが認証なし前提）
- **機密情報**:
  - API URLは.envファイルで管理（Gitにコミットしない）
  - .env.exampleをテンプレートとして提供

### 3.5 保守性
- **コード品質**:
  - TypeScript使用（型安全性）
  - ESLint + Prettierでコードフォーマット統一
  - コンポーネント単位でのモジュール化
- **テスト**:
  - ユニットテスト（Jest/Vitest）
  - E2Eテスト（Playwright）※QA-Testerフェーズで実装
- **ドキュメント**:
  - README.mdに環境構築手順
  - コンポーネントにJSDoc/TSDocコメント

---

## 4. 技術要件

### 4.1 技術スタック
- **フレームワーク**: Next.js (最新安定版、App Routerまたは Pages Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS（推奨）またはCSS Modules
- **状態管理**: React Context API または Zustand（必要に応じて）
- **APIクライアント**: fetch API（Next.js標準）
- **ビルドツール**: Next.jsビルトインのWebpack/Turbopack
- **パッケージマネージャー**: npm または pnpm

### 4.2 アーキテクチャ
```
src/
├── app/                 # Next.js App Router
│   ├── layout.tsx       # ルートレイアウト
│   ├── page.tsx         # ホームページ（Inboxビュー）
│   ├── today/           # Todayビュー
│   ├── upcoming/        # Upcomingビュー
│   ├── search/          # 検索結果ビュー
│   └── areas/           # エリア & プロジェクトビュー
├── components/          # 再利用可能コンポーネント
│   ├── layout/
│   │   ├── Header.tsx
│   │   ├── Sidebar.tsx
│   │   └── ConnectionStatus.tsx
│   ├── tasks/
│   │   ├── TaskList.tsx
│   │   ├── TaskItem.tsx
│   │   ├── TaskDetail.tsx
│   │   └── TaskCreateForm.tsx
│   ├── projects/
│   │   ├── ProjectList.tsx
│   │   └── ProjectCreateForm.tsx
│   ├── ui/
│   │   ├── SearchBox.tsx
│   │   ├── RefreshButton.tsx
│   │   ├── Button.tsx
│   │   ├── Input.tsx
│   │   ├── Modal.tsx
│   │   └── Toast.tsx
│   └── shared/
│       ├── Loading.tsx
│       └── ErrorBoundary.tsx
├── lib/                 # ユーティリティ
│   ├── api/
│   │   ├── client.ts    # ベースAPIクライアント
│   │   ├── tasks.ts     # タスク関連API呼び出し
│   │   ├── projects.ts  # プロジェクト関連API呼び出し
│   │   ├── areas.ts     # エリア関連API呼び出し
│   │   └── health.ts    # ヘルスチェック
│   ├── mock.ts          # モックデータ
│   ├── types.ts         # TypeScript型定義
│   └── utils.ts         # ヘルパー関数
├── hooks/               # カスタムReactフック
│   ├── useTasks.ts
│   ├── useAutoRefresh.ts
│   ├── useAreas.ts
│   ├── useSearch.ts
│   ├── useHealthCheck.ts
│   └── useTaskCreate.ts
└── styles/              # グローバルスタイル
    └── globals.css
```

### 4.3 API連携

#### 設定
```bash
# .env.local (Gitから除外)
NEXT_PUBLIC_API_BASE_URL=http://<MAC_TAILSCALE_IP>:8000
NEXT_PUBLIC_MOCK_MODE=false
NEXT_PUBLIC_AUTO_REFRESH_INTERVAL=60000  # 1分（ミリ秒単位）
```

#### APIクライアント実装
- **ベースURL**: 環境変数から取得
- **エラーハンドリング**: try-catch + カスタムエラークラス
- **タイムアウト**: 10秒
- **リトライロジック**: 3回まで自動リトライ（指数バックオフ）

#### APIエンドポイント

**ベースURL**: `http://<MAC_TAILSCALE_IP>:8000` (環境変数で設定)

##### タスクエンドポイント

| エンドポイント | メソッド | 説明 | リクエストボディ | レスポンス |
|----------|--------|-------------|--------------|----------|
| `/todos/inbox` | GET | インボックスのタスク一覧取得 | - | `Task[]` |
| `/todos/today` | GET | 今日のタスク一覧取得 | - | `Task[]` |
| `/todos?list={list_name}` | GET | 指定リストのタスク取得 | - | `Task[]` |
| `/todos/{task_id}` | GET | タスク詳細情報取得 | - | `Task` |
| `/todos/search?q={query}` | GET | タスク検索 | - | `Task[]` |
| `/todos` | POST | 新規タスク作成 | `CreateTaskRequest` | `Task` |
| `/todos/{task_id}/complete` | PUT | タスクを完了にする | - | `Task` |

##### エリアエンドポイント

| エンドポイント | メソッド | 説明 | レスポンス |
|----------|--------|-------------|----------|
| `/areas` | GET | エリア一覧取得 | `Area[]` |
| `/areas/{area_name}` | GET | エリア詳細（プロジェクト・タスク含む） | `AreaDetail` |

##### プロジェクトエンドポイント

| エンドポイント | メソッド | 説明 | リクエストボディ | レスポンス |
|----------|--------|-------------|--------------|----------|
| `/projects?area={area_name}` | GET | 指定エリアのプロジェクト一覧取得 | - | `Project[]` |
| `/projects/{project_name}/tasks` | GET | プロジェクト配下のタスク一覧取得 | - | `Task[]` |
| `/projects` | POST | 新規プロジェクト作成 | `CreateProjectRequest` | `Project` |

##### システムエンドポイント

| エンドポイント | メソッド | 説明 | レスポンス |
|----------|--------|-------------|----------|
| `/health` | GET | APIサーバーのヘルスチェック | `{ status: "ok" }` |

### 4.4 モック開発モード

#### 目的
Mac環境がない開発者でも作業できるよう、モックデータを用意

#### 実装
```typescript
// lib/mock.ts
export const mockInboxTasks = [
  {
    id: "mock-task-1",
    title: "牛乳を買う",
    notes: "低脂肪乳",
    due_date: "2026-02-01",
    tags: ["買い物", "家事"],
    status: "open"
  },
  // ... 追加のモックデータ
];
```

#### 有効化
```typescript
// lib/api.ts
const useMockMode = process.env.NEXT_PUBLIC_MOCK_MODE === 'true';

export async function fetchInboxTasks() {
  if (useMockMode) {
    return Promise.resolve(mockInboxTasks);
  }
  // 実際のAPI呼び出し
}
```

---

## 5. データモデル

### 5.1 タスク
```typescript
interface Task {
  id: string;                    // 一意識別子
  title: string;                 // タスクタイトル
  notes?: string;                // メモ・説明（任意）
  due_date?: string;             // 期限（ISO日付文字列 YYYY-MM-DD）
  tags?: string[];               // タグ名の配列
  status: 'open' | 'completed';  // タスクステータス
  project_id?: string;           // 親プロジェクトID（任意）
  area_id?: string;              // 親エリアID（任意）
}
```

### 5.2 エリア
```typescript
interface Area {
  id: string;                    // 一意識別子
  name: string;                  // エリア名
  project_count: number;         // このエリア内のプロジェクト数
}
```

### 5.3 プロジェクト
```typescript
interface Project {
  id: string;                    // 一意識別子
  name: string;                  // プロジェクト名
  task_count: number;            // このプロジェクト内のタスク数
  area_id?: string;              // 親エリアID（任意）
}
```

### 5.4 エリア詳細レスポンス
```typescript
interface AreaDetail {
  projects: Project[];           // このエリア内のプロジェクト
  standalone_tasks: Task[];      // プロジェクトに属さないタスク
}
```

### 5.5 タスク作成リクエスト
```typescript
interface CreateTaskRequest {
  title: string;                 // タスクタイトル（必須）
  notes?: string;                // メモ・説明（任意）
  due_date?: string;             // 期限（ISO日付文字列 YYYY-MM-DD）
  tags?: string[];               // タグ名の配列
  project_id?: string;           // 親プロジェクトID（任意）
  area_id?: string;              // 親エリアID（任意）
  list?: string;                 // リスト名（例: "inbox", "today"）
}
```

### 5.6 プロジェクト作成リクエスト
```typescript
interface CreateProjectRequest {
  name: string;                  // プロジェクト名（必須）
  area_id?: string;              // 親エリアID（任意）
  notes?: string;                // プロジェクト説明（任意）
  deadline?: string;             // 期限（ISO日付文字列 YYYY-MM-DD）
}
```

### 5.7 ヘルスチェックレスポンス
```typescript
interface HealthResponse {
  status: 'ok' | 'error';        // サーバー稼働状態
  timestamp?: string;            // レスポンスタイムスタンプ
  version?: string;              // APIバージョン
}
```

---

## 6. ユーザーインターフェース仕様

### 6.1 レイアウト構造
```
┌────────────────────────────────────────────────────────┐
│ ヘッダー（タイトル + 検索 + ステータス + 更新）        │
├──────────┬─────────────────────────────────────────────┤
│          │                                             │
│サイドバー│  メインコンテンツエリア                      │
│          │  （タスクリスト / タスク詳細 / フォーム）    │
│ [検索]   │                                             │
│          │  [ ] タスク1                                │
│ - Inbox  │  [x] タスク2                                │
│ - Today  │  [ ] タスク3                                │
│ - Upcoming│                                            │
│ - Areas  │  [+ 新規タスクボタン]                       │
│   - 仕事 [+]│                                          │
│     - プロジェクト1│                                   │
│   - 個人 [+]│                                          │
│          │                                             │
└──────────┴─────────────────────────────────────────────┘
```

### 6.2 コンポーネント仕様

#### サイドバー
- **幅**: 240px（固定）
- **背景**: 薄いグレー (#F7F7F7)
- **ナビゲーション項目**:
  - アイコン + ラベル
  - ホバー時: 背景色変化
  - 選択時: 背景色 + 左ボーダー
- **エリア/プロジェクト**:
  - 折りたたみ可能
  - インデントで階層構造を表現

#### タスクリスト
- **アイテム高さ**: 48px（1行）〜可変（メモ表示時）
- **チェックボックス**: 左端、24x24px
- **タイトル**: 中央、オーバーフロー時は切り詰め
- **期限**: 右端、小さめフォント
- **タグ**: タイトル下に表示（色付きバッジ）
- **ホバー**: 背景色変化 + シャドウ

#### タスク詳細パネル
- **位置**: 画面右側（またはモーダル）
- **幅**: 400px
- **内容**:
  - 閉じるボタン（右上）
  - タスクタイトル（大きめ）
  - チェックボックス（完了状態）
  - 期限（アイコン + 日付）
  - タグ（バッジ）
  - メモ（全文表示）

#### 更新ボタン
- **位置**: ヘッダー右上
- **アイコン**: 更新アイコン（回転アニメーション中）
- **ツールチップ**: "最終更新: XX:XX"

#### 検索ボックス
- **位置**: ヘッダー中央またはサイドバー上部
- **幅**: 300px（ヘッダー配置時）、100%（サイドバー配置時）
- **プレースホルダー**: "タスクを検索..."
- **アイコン**: 左側に検索アイコン、右側にクリアボタン（入力時のみ表示）
- **動作**:
  - 入力後300msでAPI検索実行（デバウンス）
  - Enterキーで即座に検索
  - Escapeキーで検索クリア

#### タスク作成フォーム（モーダル）
- **サイズ**: 600x500px
- **レイアウト**:
  - タイトル: "新規タスク作成"
  - 入力フィールド（縦配置）:
    - タスク名（1行テキスト、必須）
    - メモ（複数行テキストエリア、任意）
    - 期限（日付ピッカー、任意）
    - タグ（タグ入力フィールド、任意）
    - 所属先（ドロップダウン、任意）
  - アクションボタン:
    - キャンセル（左下）
    - 作成（右下、プライマリボタン）
- **バリデーション**:
  - タスク名が空の場合、作成ボタンを無効化
  - エラーメッセージは入力フィールド下に表示

#### プロジェクト作成フォーム（モーダル）
- **サイズ**: 500x400px
- **レイアウト**:
  - タイトル: "新規プロジェクト作成"
  - 入力フィールド:
    - プロジェクト名（1行テキスト、必須）
    - エリア（ドロップダウン、任意）
    - 説明（複数行テキストエリア、任意）
    - 期限（日付ピッカー、任意）
  - アクションボタン:
    - キャンセル / 作成

#### 接続ステータスインジケータ
- **位置**: ヘッダー右上（更新ボタンの左）
- **サイズ**: 8x8px円 + ラベル
- **状態表示**:
  - 緑色 + "接続中": APIサーバー正常
  - 赤色 + "切断": APIサーバーエラー
  - 灰色 + "未接続": 初期状態
- **ホバー時**:
  - ツールチップ表示
  - 内容: 最終チェック時刻、APIバージョン、レスポンスタイム

### 6.3 デザインシステム

#### カラーパレット
```css
/* プライマリカラー */
--color-primary: #4A90E2;       /* ブルー */
--color-secondary: #7B68EE;     /* パープル */

/* ニュートラルカラー */
--color-background: #FFFFFF;    /* ホワイト */
--color-sidebar: #F7F7F7;       /* ライトグレー */
--color-border: #E0E0E0;        /* グレー */
--color-text-primary: #333333;  /* ダークグレー */
--color-text-secondary: #666666;/* ミディアムグレー */

/* ステータスカラー */
--color-success: #4CAF50;       /* グリーン */
--color-error: #F44336;         /* レッド */
--color-warning: #FF9800;       /* オレンジ */
```

#### タイポグラフィ
```css
/* フォントファミリー */
--font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

/* フォントサイズ */
--text-xs: 12px;
--text-sm: 14px;
--text-base: 16px;
--text-lg: 18px;
--text-xl: 24px;

/* フォントウェイト */
--font-normal: 400;
--font-medium: 500;
--font-semibold: 600;
```

#### スペーシング
```css
/* スペーシングスケール（Tailwind互換） */
--space-1: 4px;
--space-2: 8px;
--space-3: 12px;
--space-4: 16px;
--space-6: 24px;
--space-8: 32px;
```

---

## 7. 開発ワークフロー

### 7.1 セットアップ
1. リポジトリをクローン
2. 依存関係インストール: `npm install`
3. `.env.example` を `.env.local` にコピー
4. Mac環境なしで開発する場合は `NEXT_PUBLIC_MOCK_MODE=true` に設定
5. 開発サーバー起動: `npm run dev`

### 7.2 実装フェーズ

#### フェーズ1: 基盤構築（スプリント1）
- [ ] Next.jsプロジェクトセットアップ
- [ ] TypeScript設定
- [ ] Tailwind CSS設定
- [ ] 基本レイアウト（ヘッダー + サイドバー + メイン）
- [ ] モックデータ実装
- [ ] エラーハンドリング付きベースAPIクライアント
- [ ] ヘルスチェック実装
- [ ] 接続ステータスインジケータ

#### フェーズ2: コア機能（スプリント2）
- [ ] APIクライアント実装（タスク、エリア、プロジェクト）
- [ ] Inboxビューとタスクリスト
- [ ] Todayビュー
- [ ] サイドバーナビゲーション
- [ ] タスク詳細表示
- [ ] タスク完了機能（チェックボックス）

#### フェーズ3: 自動更新 & 検索（スプリント3）
- [ ] 自動更新メカニズム（1分間隔）
- [ ] 手動更新ボタン
- [ ] 検索ボックスコンポーネント
- [ ] 検索結果ビュー
- [ ] 検索API連携
- [ ] デバウンス実装

#### フェーズ4: エリア & プロジェクト（スプリント4）
- [ ] エリア一覧ビュー
- [ ] エリア詳細ビュー（プロジェクト含む）
- [ ] プロジェクトタスクリスト
- [ ] サイドバー折りたたみ項目
- [ ] プロジェクト作成フォーム
- [ ] プロジェクト作成API連携

#### フェーズ5: タスク作成 & フォーム（スプリント5）
- [ ] タスク作成フォーム（モーダル）
- [ ] フォームバリデーション
- [ ] 日付ピッカーコンポーネント
- [ ] タグ入力コンポーネント
- [ ] タスク作成API連携
- [ ] 楽観的UI更新

#### フェーズ6: 仕上げ & テスト（スプリント6）
- [ ] レスポンシブデザイン改良
- [ ] 全操作のローディング状態
- [ ] アニメーション & トランジション
- [ ] トースト通知
- [ ] エラーハンドリング改善
- [ ] アクセシビリティ改善（ARIAラベル、キーボードナビゲーション）
- [ ] パフォーマンス最適化
- [ ] E2Eテストカバレッジ

---

## 8. 受入基準

### 8.1 完了の定義
各機能は以下を満たした時点で完了とする:

- [ ] 機能が要件通りに動作する
- [ ] TypeScript型エラーがゼロ
- [ ] ESLint警告がゼロ
- [ ] ユニットテストが書かれている（カバレッジ80%以上）
- [ ] モックモードと本番モード両方で動作確認済み
- [ ] コードレビュー承認済み
- [ ] ドキュメント更新済み

### 8.2 システム全体の受入基準
プロジェクト全体として以下を満たす:

**基本機能**:
- [ ] すべての主要ビュー（Inbox, Today, Upcoming, Areas, Projects）が動作する
- [ ] タスクの完了状態変更が正常に動作する
- [ ] タスク検索が正常に動作する（キーワード入力 → 結果表示）
- [ ] タスク作成フォームから新規タスクが作成できる
- [ ] プロジェクト作成フォームから新規プロジェクトが作成できる

**データ同期**:
- [ ] 1分間隔の自動更新が動作する
- [ ] 手動更新ボタンが機能する
- [ ] ヘルスチェックが定期的に実行される
- [ ] 接続ステータスが正しく表示される

**エラーハンドリング**:
- [ ] APIエラー時に適切なメッセージが表示される
- [ ] バリデーションエラーがフォームに表示される
- [ ] ネットワークエラー時に再試行オプションが提供される

**開発環境**:
- [ ] モックモードで開発・テストができる
- [ ] .env.exampleが提供され、README.mdにセットアップ手順が記載されている
- [ ] すべてのAPIエンドポイントがドキュメント化されている

**品質**:
- [ ] レスポンシブデザインが1024px以上で正常に表示される
- [ ] Chrome/Edge最新版で動作確認済み
- [ ] TypeScript型エラーがゼロ
- [ ] ESLint警告がゼロ
- [ ] 主要機能のE2Eテストが通過する

---

## 9. 依存関係 & 制約

### 9.1 外部依存関係
- **Mac APIサーバー**: バックエンドAPIの可用性に依存
  - FastAPIベースのRESTful API
  - 全エンドポイント仕様は本ドキュメント セクション4.3 に記載
- **Tailscale**: ネットワーク接続に依存
- **ブラウザ互換性**: モダンブラウザの機能に依存
  - Fetch API
  - ES2020+ JavaScript機能
  - CSS Grid/Flexbox

### 9.2 技術的制約
- Windows環境での動作が前提
- Tailscaleローカルネットワーク経由の通信
- Mac側APIサーバーが起動している必要がある
- インターネット接続が必要（Tailscale経由）

### 9.3 既知の制限事項
- タスクの編集機能は未サポート（タイトル・メモ・期限の変更不可）
- タスク・プロジェクトの削除機能は未サポート
- プロジェクトの編集機能は未サポート
- オフラインモードなし（常にネットワーク接続が必要）
- 複数デバイス間のリアルタイム同期なし（WebSocketなし）
- ファイル添付機能なし
- タスクの並べ替え（ドラッグ&ドロップ）なし

---

## 10. 将来の拡張機能（Phase 2以降で検討）

以下の機能は将来のフェーズで検討:

**Phase 2 候補機能**:
- タスクの編集機能（タイトル・メモ・期限・タグの変更）
- タスクの削除機能
- プロジェクトの編集・削除機能
- 高度な検索フィルタ（日付範囲、ステータス、タグの組み合わせ）
- タスクの並べ替え（ドラッグ&ドロップ）
- タグ管理画面（タグ一覧、色設定、統合）

**Phase 3 候補機能**:
- キーボードショートカット（Things3互換）
- ダークモード
- カスタムビュー（保存された検索条件）
- バルク操作（複数タスクの一括完了・移動）
- 繰り返しタスク

**長期的な機能**:
- デスクトップ通知（期限リマインダー）
- WebSocket接続によるリアルタイム更新
- オフラインキャッシュ（PWA化）
- マルチユーザー対応（共有プロジェクト）
- モバイル専用UI（レスポンシブ拡張）
- Things3データのエクスポート機能（CSV/JSON）
- Googleカレンダー連携
- Slack/Discord通知連携
- ファイル添付機能
- チェックリスト（サブタスク）

---

## 11. 用語集

| 用語 | 定義 |
|------|------------|
| Things3 | macOS/iOS向けタスク管理アプリケーション |
| Tailscale | VPNソフトウェア、デバイス間のセキュアな接続を提供 |
| Inbox | 未分類のタスクを一時保管する場所 |
| Area（エリア） | タスクやプロジェクトをグループ化する大分類（例: 仕事、個人） |
| Project（プロジェクト） | 複数のタスクをまとめる単位（Areaに属する） |
| Mock Mode（モックモード） | 実際のAPIサーバーなしで開発するためのモード |
| Auto-refresh（自動更新） | 定期的に自動でデータを再取得する機能 |

---

## 12. 参照資料

- **プロジェクトルート**: `projects/windows-2-things-3/`
- **PRP文書**: `docs/PRP.md`
- **API仕様**: 本ドキュメント セクション4.3（完全版）
- **エージェント設定**: `library/config/agents.json`
- **デザインモックアップ**: `resources/mockups/`（Designerエージェントにより作成予定）
- **実装プラン**: `spec/implementation_plan.md`（Architectエージェントにより作成予定）

---

**ドキュメントステータス**: 完全版API仕様統合済み v1.1
**次のステップ**:
1. PM承認待ち（API仕様統合版）
2. Researcher による技術調査（Next.js, TypeScript, API統合パターン）
3. Designer によるUIモックアップ作成（検索UI、フォームUI含む）
4. Architect による実装プラン策定（6スプリント構成）

---

**変更履歴**:
- **v1.1 (2026-01-31)**: 完全版API仕様統合
  - 13エンドポイント追加（タスク、プロジェクト、エリア、検索、ヘルスチェック）
  - 4つの新規ユーザーストーリー追加（検索、タスク作成、プロジェクト作成、ヘルスチェック）
  - 5つの新規機能仕様追加
  - 詳細なコンポーネント構造でアーキテクチャを更新
  - 6つの実装フェーズに拡張
  - 検索・作成機能を含むようスコープを更新
- **v1.0 (2026-01-31)**: 初版要件定義書

---

**作成者**: Requirements-Analyst Agent
**レビュー要求先**: Project-Manager
**作成日**: 2026-01-31
